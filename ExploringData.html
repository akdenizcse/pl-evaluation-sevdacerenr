<html>

<head>
<style type="text/css">
.inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.left {
  text-align: left;
}
.right {
  text-align: right;
}
.center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
<title></title>
</head>

<body>

<b>Exploring Data Using R</b>

<p>We will make data discovery with the data set given below.</p>

<div class="chunk" id="unnamed-chunk-1"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">custdata</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">read.table</span><span class="hl std">(</span><span class="hl str">'https://github.com/scizmeli/datascience_class_helper_files/raw/master/custdata1.tsv'</span><span class="hl std">,</span><span class="hl kwc">header</span><span class="hl std">=T,</span><span class="hl kwc">sep</span><span class="hl std">=</span><span class="hl str">','</span><span class="hl std">)</span>
</pre></div>
</div></div>

<p>This data set is as follows:</p>

<div class="chunk" id="unnamed-chunk-2"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">head</span><span class="hl std">(custdata)</span>
</pre></div>
<div class="output"><pre class="knitr r">##   X state.of.res  custid sex is.employed income       marital.stat health.ins
## 1 1      Alabama 1063014   F        TRUE  82000            Married       TRUE
## 2 2      Alabama 1192089   M          NA  49000            Married       TRUE
## 3 3      Alabama   16551   F          NA   7000            Married       TRUE
## 4 4      Alabama 1079878   F          NA  37200 Divorced/Separated       TRUE
## 5 5      Alabama  502705   M        TRUE  70000            Married      FALSE
## 6 6      Alabama  674271   M       FALSE      0            Married       TRUE
##                   housing.type recent.move num.vehicles age is.employed.fix1
## 1                       Rented       FALSE            2  43         employed
## 2     Homeowner free and clear       FALSE            2  77          missing
## 3 Homeowner with mortgage/loan       FALSE            2  46          missing
## 4 Homeowner with mortgage/loan       FALSE            1  62          missing
## 5                       Rented       FALSE            4  37         employed
## 6                       Rented        TRUE            1  54     not employed
##   age.normalized Median.Income income.norm        gp income.lt.30K age.range
## 1     -0.4612000         52371   1.5657520 0.9350600         FALSE   (25,65]
## 2      1.3412291         52371   0.9356323 0.1162411         FALSE  (65,Inf]
## 3     -0.3021621         52371   0.1336618 0.9906832          TRUE   (25,65]
## 4      0.5460398         52371   0.7103168 0.1873560         FALSE   (25,65]
## 5     -0.7792757         52371   1.3366176 0.8490238         FALSE   (25,65]
## 6      0.1219389         52371   0.0000000 0.3295085          TRUE   (25,65]
##   Income
## 1     NA
## 2     NA
## 3   4500
## 4  20000
## 5  12000
## 6 180000
</pre></div>
</div></div>

<p> The "summary" code clearly shows how many data is in which column. </p>

<div class="chunk" id="unnamed-chunk-3"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">summary</span><span class="hl std">(custdata)</span>
</pre></div>
<div class="output"><pre class="knitr r">##        X                state.of.res     custid        sex     is.employed    
##  Min.   :   1.0   California  :114   Min.   :   2068   F:440   Mode :logical  
##  1st Qu.: 250.8   New York    : 94   1st Qu.: 345667   M:560   FALSE:73       
##  Median : 500.5   Pennsylvania: 63   Median : 693403           TRUE :599      
##  Mean   : 500.5   Ohio        : 59   Mean   : 698500           NA's :328      
##  3rd Qu.: 750.2   Illinois    : 52   3rd Qu.:1044606                          
##  Max.   :1000.0   Texas       : 51   Max.   :1414286                          
##                   (Other)     :567                                            
##      income                   marital.stat health.ins     
##  Min.   : -8700   Divorced/Separated:155   Mode :logical  
##  1st Qu.: 14600   Married           :516   FALSE:159      
##  Median : 35000   Never Married     :233   TRUE :841      
##  Mean   : 53505   Widowed           : 96                  
##  3rd Qu.: 67000                                           
##  Max.   :615000                                           
##                                                           
##                        housing.type recent.move      num.vehicles  
##  Homeowner free and clear    :157   Mode :logical   Min.   :0.000  
##  Homeowner with mortgage/loan:412   FALSE:820       1st Qu.:1.000  
##  Occupied with no rent       : 11   TRUE :124       Median :2.000  
##  Rented                      :364   NA's :56        Mean   :1.916  
##  NA's                        : 56                   3rd Qu.:2.000  
##                                                     Max.   :6.000  
##                                                     NA's   :56     
##       age            is.employed.fix1 age.normalized     Median.Income  
##  Min.   :  0.0   employed    :599     Min.   :-2.74074   Min.   :37427  
##  1st Qu.: 38.0   missing     :328     1st Qu.:-0.72626   1st Qu.:44819  
##  Median : 50.0   not employed: 73     Median :-0.09011   Median :50118  
##  Mean   : 51.7                        Mean   : 0.00000   Mean   :50919  
##  3rd Qu.: 64.0                        3rd Qu.: 0.65207   3rd Qu.:55534  
##  Max.   :146.7                        Max.   : 5.03516   Max.   :68187  
##                                                                         
##   income.norm            gp            income.lt.30K      age.range  
##  Min.   :-0.1956   Min.   :0.0002281   Mode :logical   (25,65] :732  
##  1st Qu.: 0.2812   1st Qu.:0.2618117   FALSE:562       (65,Inf]:212  
##  Median : 0.6712   Median :0.5127602   TRUE :438       [0,25]  : 56  
##  Mean   : 1.0781   Mean   :0.5016471                                 
##  3rd Qu.: 1.3508   3rd Qu.:0.7405944                                 
##  Max.   :11.7870   Max.   :0.9988350                                 
##                                                                      
##      Income      
##  Min.   :     0  
##  1st Qu.: 25000  
##  Median : 45000  
##  Mean   : 66199  
##  3rd Qu.: 82000  
##  Max.   :615000  
##  NA's   :328
</pre></div>
</div></div>

<p> Income ranges from zero to over half a million dollars; a very wide range.! </p>

<div class="chunk" id="unnamed-chunk-4"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">class</span><span class="hl std">(custdata</span><span class="hl opt">$</span><span class="hl std">income)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;integer&quot;
</pre></div>
</div></div>

<p> Spotting problems using graphics and visualization </p>

<div class="chunk" id="unnamed-chunk-5"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">plot</span><span class="hl std">(custdata</span><span class="hl opt">$</span><span class="hl std">income,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-5-1.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" class="plot" /></div></div>

<p> A histogram tells you where your data is concentrated. It also visually highlights outliers and anomalies. </p>

<div class="chunk" id="unnamed-chunk-6"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com">#library(ggplot)</span>
<span class="hl kwd">library</span><span class="hl std">(ggplot2)</span>
<span class="hl kwd">library</span><span class="hl std">(scales)</span>
<span class="hl kwd">ggplot</span><span class="hl std">(custdata)</span> <span class="hl opt">+</span> <span class="hl kwd">geom_density</span><span class="hl std">(</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=income))</span> <span class="hl opt">+</span>
<span class="hl kwd">scale_x_continuous</span><span class="hl std">(</span><span class="hl kwc">labels</span><span class="hl std">=dollar)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-6-1.png" title="plot of chunk unnamed-chunk-6" alt="plot of chunk unnamed-chunk-6" class="plot" /></div></div>


<p> "aes(x=marital.stat)" in this code "marital.stat" value that is we want to plot </p>

<div class="chunk" id="unnamed-chunk-7"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">ggplot</span><span class="hl std">(custdata)</span> <span class="hl opt">+</span>
<span class="hl kwd">geom_bar</span><span class="hl std">(</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=state.of.res),</span>
<span class="hl kwc">fill</span><span class="hl std">=</span><span class="hl str">&quot;purple&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
<span class="hl kwd">coord_flip</span><span class="hl std">()</span> <span class="hl opt">+</span>
<span class="hl kwd">theme</span><span class="hl std">(</span><span class="hl kwc">axis.text.y</span><span class="hl std">=</span><span class="hl kwd">element_text</span><span class="hl std">(</span><span class="hl kwc">size</span><span class="hl std">=</span><span class="hl kwd">rel</span><span class="hl std">(</span><span class="hl num">0.8</span><span class="hl std">)))</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-7-1.png" title="plot of chunk unnamed-chunk-7" alt="plot of chunk unnamed-chunk-7" class="plot" /></div></div>

<p> BAR CHARTS FOR TWO CATEGORICAL VARIABLES

Let's examine the relationship between marital status and the probability of health insurance coverage. The most straightforward way to visualize this is with a stacked bar chart, as shown in figure 3.15. </p>

<div class="chunk" id="unnamed-chunk-8"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">ggplot</span><span class="hl std">(custdata)</span> <span class="hl opt">+</span> <span class="hl kwd">geom_bar</span><span class="hl std">(</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=marital.stat,</span>
<span class="hl kwc">fill</span><span class="hl std">=health.ins))</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-8-1.png" title="plot of chunk unnamed-chunk-8" alt="plot of chunk unnamed-chunk-8" class="plot" /></div></div>


<p> Plotting data with a rug </p>

<div class="chunk" id="unnamed-chunk-9"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">ggplot</span><span class="hl std">(custdata,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=marital.stat))</span> <span class="hl opt">+</span>
<span class="hl kwd">geom_bar</span><span class="hl std">(</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">fill</span><span class="hl std">=health.ins),</span> <span class="hl kwc">position</span><span class="hl std">=</span><span class="hl str">&quot;fill&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
<span class="hl kwd">geom_point</span><span class="hl std">(</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">y</span><span class="hl std">=</span><span class="hl opt">-</span><span class="hl num">0.05</span><span class="hl std">),</span> <span class="hl kwc">size</span><span class="hl std">=</span><span class="hl num">0.75</span><span class="hl std">,</span> <span class="hl kwc">alpha</span><span class="hl std">=</span><span class="hl num">0.3</span><span class="hl std">,</span>
<span class="hl kwc">position</span><span class="hl std">=</span><span class="hl kwd">position_jitter</span><span class="hl std">(</span><span class="hl kwc">h</span><span class="hl std">=</span><span class="hl num">0.01</span><span class="hl std">))</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-9-1.png" title="plot of chunk unnamed-chunk-9" alt="plot of chunk unnamed-chunk-9" class="plot" /></div></div>

<p> Plotting a bar chart with and without facets </p>
<div class="chunk" id="unnamed-chunk-10"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">ggplot</span><span class="hl std">(custdata)</span> <span class="hl opt">+</span>
<span class="hl kwd">geom_bar</span><span class="hl std">(</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=housing.type,</span> <span class="hl kwc">fill</span><span class="hl std">=marital.stat ),</span>
<span class="hl kwc">position</span><span class="hl std">=</span><span class="hl str">&quot;dodge&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
<span class="hl kwd">theme</span><span class="hl std">(</span><span class="hl kwc">axis.text.x</span> <span class="hl std">=</span> <span class="hl kwd">element_text</span><span class="hl std">(</span><span class="hl kwc">angle</span> <span class="hl std">=</span> <span class="hl num">45</span><span class="hl std">,</span> <span class="hl kwc">hjust</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">))</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-10-1.png" title="plot of chunk unnamed-chunk-10" alt="plot of chunk unnamed-chunk-10" class="plot" /></div></div>

<p> Examining the correlation between age and income </p>

<div class="chunk" id="unnamed-chunk-11"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">custdata2</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">subset</span><span class="hl std">(custdata,(custdata</span><span class="hl opt">$</span><span class="hl std">age</span> <span class="hl opt">&gt;</span> <span class="hl num">0</span> <span class="hl opt">&amp;</span> <span class="hl std">custdata</span><span class="hl opt">$</span><span class="hl std">age</span> <span class="hl opt">&lt;</span> <span class="hl num">100</span> <span class="hl opt">&amp;</span> <span class="hl std">custdata</span><span class="hl opt">$</span><span class="hl std">income</span> <span class="hl opt">&gt;</span> <span class="hl num">0</span><span class="hl std">))</span>
<span class="hl kwd">cor</span><span class="hl std">(custdata2</span><span class="hl opt">$</span><span class="hl std">age, custdata2</span><span class="hl opt">$</span><span class="hl std">income)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] -0.02240845
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">head</span><span class="hl std">(custdata2)</span>
</pre></div>
<div class="output"><pre class="knitr r">##   X state.of.res  custid sex is.employed income       marital.stat health.ins
## 1 1      Alabama 1063014   F        TRUE  82000            Married       TRUE
## 2 2      Alabama 1192089   M          NA  49000            Married       TRUE
## 3 3      Alabama   16551   F          NA   7000            Married       TRUE
## 4 4      Alabama 1079878   F          NA  37200 Divorced/Separated       TRUE
## 5 5      Alabama  502705   M        TRUE  70000            Married      FALSE
## 7 7      Alabama   15917   F        TRUE  24000 Divorced/Separated       TRUE
##                   housing.type recent.move num.vehicles age is.employed.fix1
## 1                       Rented       FALSE            2  43         employed
## 2     Homeowner free and clear       FALSE            2  77          missing
## 3 Homeowner with mortgage/loan       FALSE            2  46          missing
## 4 Homeowner with mortgage/loan       FALSE            1  62          missing
## 5                       Rented       FALSE            4  37         employed
## 7     Homeowner free and clear       FALSE            1  70         employed
##   age.normalized Median.Income income.norm        gp income.lt.30K age.range
## 1     -0.4612000         52371   1.5657520 0.9350600         FALSE   (25,65]
## 2      1.3412291         52371   0.9356323 0.1162411         FALSE  (65,Inf]
## 3     -0.3021621         52371   0.1336618 0.9906832          TRUE   (25,65]
## 4      0.5460398         52371   0.7103168 0.1873560         FALSE   (25,65]
## 5     -0.7792757         52371   1.3366176 0.8490238         FALSE   (25,65]
## 7      0.9701407         52371   0.4582689 0.5097943          TRUE  (65,Inf]
##   Income
## 1     NA
## 2     NA
## 3   4500
## 4  20000
## 5  12000
## 7 120000
</pre></div>
</div></div>


<p> The negative correlation is surprising, since you'd expect that income should increase as people get older. A visualization gives you more insight into what's going on than a single number can. Let's try a scatter plot first; you plot figure </p>

<div class="chunk" id="unnamed-chunk-12"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">ggplot</span><span class="hl std">(custdata2,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=age,</span> <span class="hl kwc">y</span><span class="hl std">=income))</span> <span class="hl opt">+</span>
<span class="hl kwd">geom_point</span><span class="hl std">()</span> <span class="hl opt">+</span> <span class="hl kwd">ylim</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">200000</span><span class="hl std">)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: Removed 32 rows containing missing values (geom_point).
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-12-1.png" title="plot of chunk unnamed-chunk-12" alt="plot of chunk unnamed-chunk-12" class="plot" /></div></div>

<div class="chunk" id="unnamed-chunk-13"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">ggplot</span><span class="hl std">(custdata2,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=age,</span> <span class="hl kwc">y</span><span class="hl std">=income))</span> <span class="hl opt">+</span> <span class="hl kwd">geom_point</span><span class="hl std">()</span> <span class="hl opt">+</span> <span class="hl kwd">stat_smooth</span><span class="hl std">(</span><span class="hl kwc">method</span><span class="hl std">=</span><span class="hl str">&quot;lm&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
<span class="hl kwd">ylim</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">200000</span><span class="hl std">)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: Removed 32 rows containing non-finite values (stat_smooth).
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: Removed 32 rows containing missing values (geom_point).
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-13-1.png" title="plot of chunk unnamed-chunk-13" alt="plot of chunk unnamed-chunk-13" class="plot" /></div></div>


<p> In this case, the linear fit doesn't really capture the shape of the data. You can better capture the shape by instead plotting a smoothing curve through the data </p>

<div class="chunk" id="unnamed-chunk-14"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">ggplot</span><span class="hl std">(custdata2,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=age,</span> <span class="hl kwc">y</span><span class="hl std">=income))</span> <span class="hl opt">+</span> <span class="hl kwd">geom_point</span><span class="hl std">()</span> <span class="hl opt">+</span> <span class="hl kwd">geom_smooth</span><span class="hl std">()</span> <span class="hl opt">+</span>
<span class="hl kwd">ylim</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">200000</span><span class="hl std">)</span>
</pre></div>
<div class="message"><pre class="knitr r">## `geom_smooth()` using method = 'loess' and formula 'y ~ x'
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: Removed 32 rows containing non-finite values (stat_smooth).
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: Removed 32 rows containing missing values (geom_point).
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-14-1.png" title="plot of chunk unnamed-chunk-14" alt="plot of chunk unnamed-chunk-14" class="plot" /></div></div>

<p> HEXBIN PLOTS
A hexbin plot is like a two-dimensional histogram. The data is divided into bins, and the number of data points in each bin is represented by color or shading. Let's go back to the income versus age example.</p>

<div class="chunk" id="unnamed-chunk-15"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com">#install.packages(&quot;hexbin&quot;)</span>
<span class="hl kwd">library</span><span class="hl std">(hexbin)</span>
<span class="hl kwd">ggplot</span><span class="hl std">(custdata2,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=age,</span> <span class="hl kwc">y</span><span class="hl std">=income))</span> <span class="hl opt">+</span> <span class="hl kwd">geom_hex</span><span class="hl std">(</span><span class="hl kwc">binwidth</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">5</span><span class="hl std">,</span> <span class="hl num">10000</span><span class="hl std">))</span> <span class="hl opt">+</span>
<span class="hl kwd">geom_smooth</span><span class="hl std">(</span><span class="hl kwc">color</span><span class="hl std">=</span><span class="hl str">&quot;white&quot;</span><span class="hl std">,</span> <span class="hl kwc">se</span><span class="hl std">=F)</span> <span class="hl opt">+</span>
<span class="hl kwd">ylim</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">200000</span><span class="hl std">)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: Removed 32 rows containing non-finite values (stat_binhex).
</pre></div>
<div class="message"><pre class="knitr r">## `geom_smooth()` using method = 'loess' and formula 'y ~ x'
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: Removed 32 rows containing non-finite values (stat_smooth).
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: Removed 13 rows containing missing values (geom_hex).
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-15-1.png" title="plot of chunk unnamed-chunk-15" alt="plot of chunk unnamed-chunk-15" class="plot" /></div></div>

</body>
</html>
